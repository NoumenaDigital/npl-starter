#!/bin/bash -e

set -o nounset
set -x

# Print an error to stderr and exit if a variable is not set.
function require_variable {
  if [[ -z "$1" ]]; then
      >&2 echo "$2"
      exit 1
  fi
}

# Send slack message with only text
function __slack {
  __require_variable "$1" "Missing argument message text"
  __require_variable "$2" "Missing argument channel"
  [[ -z "$SLACK_URL" ]] || curl -s "$SLACK_URL" --data "{\"text\": \"$1\", \"channel\": \"$2\" }"
}

require_variable "$1" "Missing argument message text"
CHANNEL=${2:-"#platform"}

__slack "$1" "$CHANNEL"
